---
import { getCollection } from 'astro:content';

const projects = await getCollection('projects');
const sortedProjects = projects
  .filter(p => !p.slug.startsWith('_'))
  .sort((a, b) => b.data.order - a.data.order)
  .slice(0, 6);

const allCategories = [...new Set(projects.filter(p => !p.slug.startsWith('_')).map(p => p.data.category))].sort();
---

<section id="projects" class="py-32 relative overflow-hidden">
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <div class="absolute top-1/3 left-1/4 w-96 h-96 bg-primary/10 rounded-full blur-3xl"></div>
  </div>

  <div class="max-w-7xl mx-auto px-6 relative z-10">
    <div class="text-center mb-16">
      <p class="text-text-secondary text-sm mb-4 font-medium tracking-wider">... /Projects ...</p>
      <h2 class="text-5xl lg:text-6xl font-display mb-6 gradient-text">Featured Work</h2>
      <p class="text-text-secondary text-lg max-w-2xl mx-auto">
        A selection of projects that showcase my skills and experience
      </p>
    </div>



    <div id="empty-state" class="hidden text-center py-20">
      <div class="glass rounded-3xl p-12 max-w-md mx-auto">
        <i class="fa-solid fa-folder-open text-6xl text-text-secondary/30 mb-6"></i>
        <h3 class="text-2xl font-display mb-4">No Projects Found</h3>
        <p class="text-text-secondary">
          No projects match the selected filter. Try selecting a different category.
        </p>
      </div>
    </div>

    <div id="projects-grid" class="grid md:grid-cols-2 gap-8">
      {sortedProjects.map((project, index) => (
        <a 
          href={`/projects/${project.slug}`}
          class="project-card group relative glass rounded-3xl overflow-hidden glass-hover border border-white/10 hover:border-primary/50 transition-all duration-500"
          style={`animation-delay: ${index * 0.1}s;`}
          data-category={project.data.category.toLowerCase()}
        >
          <!-- Added image overlay with gradient -->
          <div class="relative h-64 overflow-hidden">
            <img 
              src={project.data.image || "/placeholder.svg"} 
              alt={project.data.title}
              class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
            />
            <div class="absolute inset-0 bg-gradient-to-t from-background via-background/50 to-transparent opacity-60 group-hover:opacity-80 transition-opacity"></div>
          </div>

          <!-- Enhanced content section -->
          <div class="p-8">
            <h3 class="text-3xl font-display mb-4 group-hover:gradient-text transition-all">{project.data.title}</h3>
            
            <!-- Added tags with gradient styling -->
            <div class="flex flex-wrap gap-2 mb-4">
              {project.data.tags.map((tag) => (
                <span class="px-3 py-1 bg-primary/10 text-primary rounded-full text-xs border border-primary/20">
                  {tag}
                </span>
              ))}
            </div>
            
            <p class="text-text-secondary leading-relaxed mb-6">
              {project.data.description}
            </p>
            
            <!-- Enhanced CTA with gradient button -->
            <div class="flex items-center gap-4">
              <span class="text-sm text-text-secondary group-hover:text-primary transition-colors">View project</span>
              <div class="w-10 h-10 gradient-bg rounded-full flex items-center justify-center group-hover:translate-x-2 transition-transform glow-hover">
                <i class="fa-solid fa-arrow-right"></i>
              </div>
            </div>
          </div>

          <!-- Added corner accent decoration -->
          <div class="absolute top-4 right-4 w-12 h-12 border-t-2 border-r-2 border-primary/30 rounded-tr-2xl opacity-0 group-hover:opacity-100 transition-opacity"></div>
        </a>
      ))}
    </div>

    <!-- Added view all projects link -->
    <div class="text-center mt-12">
      <a 
        href="/projects" 
        class="inline-flex items-center gap-3 px-8 py-4 glass glass-hover rounded-full font-medium group"
      >
        View All Projects
        <i class="fa-solid fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
      </a>
    </div>
  </div>
</section>

<style>
  .project-card {
    opacity: 0;
    animation: fadeInUp 0.6s ease-out forwards;
    /* Removed display: none so projects show on initial load */
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .filter-btn.active {
    background: linear-gradient(135deg, #6366f1, #8b5cf6);
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const filterBtns = document.querySelectorAll('.filter-btn');
    const projectCards = document.querySelectorAll('.project-card');
    const emptyState = document.getElementById('empty-state');
    const projectsGrid = document.getElementById('projects-grid');
    
    projectCards.forEach((card) => {
      card.style.display = 'block';
    });
    
    const checkEmptyState = () => {
      const visibleProjects = Array.from(projectCards).filter(
        card => card.style.display !== 'none'
      );
      
      if (visibleProjects.length === 0) {
        emptyState.classList.remove('hidden');
        projectsGrid.classList.add('hidden');
      } else {
        emptyState.classList.add('hidden');
        projectsGrid.classList.remove('hidden');
      }
    };
    
    filterBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const filter = btn.getAttribute('data-filter');
        
        // Update active state
        filterBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        projectCards.forEach((card, index) => {
          const category = card.getAttribute('data-category');
          const htmlCard = card;
          
          if (filter === 'all' || category === filter) {
            htmlCard.style.display = 'block';
            setTimeout(() => {
              htmlCard.style.opacity = '1';
              htmlCard.style.transform = 'translateY(0)';
            }, index * 50);
          } else {
            htmlCard.style.opacity = '0';
            htmlCard.style.transform = 'translateY(30px)';
            setTimeout(() => {
              htmlCard.style.display = 'none';
              checkEmptyState();
            }, 300);
          }
        });
        
        // Check empty state after a short delay to allow animations
        setTimeout(checkEmptyState, 350);
      });
    });
  });
</script>
